<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –î–µ–∫–æ—Ä–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --header-font: 'Great Vibes', cursive;
            --header-size: clamp(48px, 12vw, 64px);
            --main-font: 'Roboto', sans-serif;
            --q-size: clamp(18px, 5vw, 22px);
            --opt-size: clamp(14px, 4vw, 16px);
            --accent: #1b4332;
            --text: #0a2f23;
            --glass-card: rgba(255, 255, 255, 0.1);
            --glass-item: rgba(255, 255, 255, 0.18);
            --glass-border: rgba(255, 255, 255, 0.35);
        }

        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            min-height: -webkit-fill-available;
            font-family: var(--main-font); background: #dbe4db; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            color: var(--text); -webkit-tap-highlight-color: transparent;
        }

        #fx-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; pointer-events: none; }
        .leaf-bg { position: absolute; width: 30px; height: 30px; background: #2d6a4f; border-radius: 0 100%; opacity: 0.12; }
        .smooth-leaf { position: absolute; width: 24px; height: 24px; pointer-events: none; border-radius: 0 100%; transition: transform 1.8s cubic-bezier(0.2, 0.6, 0.3, 1), opacity 1.5s ease-out; z-index: 10000; }

        @keyframes flyBackground {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.15; }
            100% { transform: translate(var(--tx), var(--ty)) rotate(720deg); opacity: 0; }
        }

        .viewport { position: relative; z-index: 100; width: 100%; max-width: 450px; padding: env(safe-area-inset-top) 20px env(safe-area-inset-bottom) 20px; box-sizing: border-box; }

        .main-card {
            background: var(--glass-card); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: 40px; padding: 30px 20px;
            width: 100%; min-height: min(580px, 85vh); display: flex; flex-direction: column;
            align-items: center; justify-content: center; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.04);
            transition: all 0.5s ease; box-sizing: border-box;
        }

        h1 { font-family: var(--header-font); font-size: var(--header-size); margin: 0 0 15px 0; color: var(--accent); text-align: center; line-height: 1; }
        .question-text { font-size: var(--q-size); font-weight: 700; margin-bottom: 15px; text-align: center; line-height: 1.2; }
        .image-box { width: 100%; height: clamp(140px, 25vh, 180px); border-radius: 20px; overflow: hidden; border: 1px solid var(--glass-border); margin-bottom: 15px; display: none; }
        .question-image { width: 100%; height: 100%; object-fit: cover; }
        .options-grid { width: 100%; display: flex; flex-direction: column; gap: 10px; }
        .option-item { background: var(--glass-item); border: 1px solid var(--glass-border); padding: clamp(12px, 3vh, 16px); border-radius: 18px; font-size: var(--opt-size); font-weight: 500; cursor: pointer; transition: 0.2s; }
        .option-item.selected { background: var(--accent); color: white; border-color: var(--accent); }
        .btn-action { width: 100%; background: var(--accent); color: white; border: none; padding: 18px; border-radius: 50px; font-size: 18px; font-weight: 600; margin-top: 20px; cursor: pointer; }
        .btn-action:disabled { opacity: 0.2; }
        .fio-input { width: 80%; border: none; border-bottom: 2px solid var(--accent); background: transparent; padding: 8px; font-size: 24px; text-align: center; outline: none; margin-bottom: 30px; color: var(--accent); -webkit-appearance: none; }

        #quiz-ui, #result-ui { display: none; width: 100%; flex-direction: column; align-items: center; }
        .score-big { font-size: 100px; font-family: var(--header-font); color: var(--accent); line-height: 1; }
        .reset-link { margin-top: 30px; font-size: 12px; opacity: 0.5; text-decoration: underline; cursor: pointer; color: var(--text); }
    </style>
</head>
<body>
<div id="fx-container"></div>
<div class="viewport">
    <div class="main-card" id="login-ui">
        <h1>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –î–µ–∫–æ—Ä–∞</h1>
        <input type="text" id="user-name" class="fio-input" placeholder="–í–∞—à–µ –∏–º—è" autocomplete="off">
        <button class="btn-action" onclick="startTest(event)">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>
    </div>
    <div class="main-card" id="quiz-ui">
        <div id="q-text" class="question-text"></div>
        <div class="image-box" id="q-img-cont"><img id="q-image" class="question-image" src=""></div>
        <div id="options-box" class="options-grid"></div>
        <button class="btn-action" id="next-btn" onclick="nextQuestion(event)" disabled>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
    </div>
    <div class="main-card" id="result-ui">
        <h1>–í–∞—à –∏—Ç–æ–≥</h1>
        <div class="score-big" id="final-score">0</div>
        <div id="final-joke" style="font-style: italic; text-align: center;"></div>
        <div class="reset-link" onclick="resetTest()">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</div>
    </div>
</div>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxab66haDgCEXv2J9QxsowVP_9J0REYMtUoLSpISxYsEoRMbu3zZmO5irPOkIZ0Mi-jdg/exec';
    const questions = [
        { q: "–ö –∫–∞–∫–æ–π –≥—Ä—É–ø–ø–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ü–µ—Ç—É–Ω–∏—è –≥–∏–±—Ä–∏–¥–Ω–∞—è –≤ —É–º–µ—Ä–µ–Ω–Ω–æ–º –∫–ª–∏–º–∞—Ç–µ?", a: ["–ú–Ω–æ–≥–æ–ª–µ—Ç–Ω–∏–∫–∏", "–î–≤—É–ª–µ—Ç–Ω–∏–∫–∏", "–û–¥–Ω–æ–ª–µ—Ç–Ω–∏–∫–∏"], c: 2 },
        { q: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è —Ä–∞—Å—Ç–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Ü–≤–µ—Ç—É—Ç –Ω–∞ –≤—Ç–æ—Ä–æ–π –≥–æ–¥?", a: ["–û–¥–Ω–æ–ª–µ—Ç–Ω–∏–∫–∏", "–î–≤—É–ª–µ—Ç–Ω–∏–∫–∏", "–ú–Ω–æ–≥–æ–ª–µ—Ç–Ω–∏–∫–∏"], c: 1 },
        { q: "–¢–∏–ø–∏—á–Ω–æ–µ –ª—É–∫–æ–≤–∏—á–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ:", imgUrl: "https://images.unsplash.com/photo-1550948390-6eb7fa773072?q=80&w=500&auto=format&fit=crop", a: ["–ì–ª–∞–¥–∏–æ–ª—É—Å", "–¢—é–ª—å–ø–∞–Ω", "–ì–µ–æ—Ä–≥–∏–Ω–∞"], c: 1 },
        { q: "–ß—Ç–æ —Ç–∞–∫–æ–µ ¬´—Å—Ç—Ä–∞—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è¬ª —Å–µ–º—è–Ω?", a: ["–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–±–æ–ª–æ—á–∫–∏", "–•–æ–ª–æ–¥ + –≤–ª–∞–≥–∞", "–ü—Ä–æ—Ç—Ä–∞–≤–ª–∏–≤–∞–Ω–∏–µ"], c: 1 },
        { q: "–ö–∞–∫–æ–π —Å–ø–æ—Å–æ–± —Ä–∞–∑–º–Ω–æ–∂–µ–Ω–∏—è —è–≤–ª—è–µ—Ç—Å—è –≤–µ–≥–µ—Ç–∞—Ç–∏–≤–Ω—ã–º?", a: ["–ü–æ—Å–µ–≤ —Å–µ–º—è–Ω", "–ß—Ä–µ–Ω–∫–æ–≤–∞–Ω–∏–µ", "–ì–∏–±—Ä–∏–¥–∏–∑–∞—Ü–∏—è"], c: 1 },
        { q: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å —Å—Ä–∞—â–∏–≤–∞–Ω–∏—è –ø—Ä–∏–≤–æ—è —Å –ø–æ–¥–≤–æ–µ–º?", a: ["–ü–∏–∫–∏—Ä–æ–≤–∫–∞", "–ü—Ä–∏–≤–∏–≤–∫–∞", "–û–∫—É—á–∏–≤–∞–Ω–∏–µ"], c: 1 },
        { q: "–ü–∏–∫–∏—Ä–æ–≤–∫–∞ ‚Äî —ç—Ç–æ:", a: ["–ü–µ—Ä–µ—Å–∞–¥–∫–∞ —Å –ø—Ä–∏—â–∏–ø–∫–æ–π –∫–æ—Ä–Ω—è", "–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —à—Ç–∞–º–±–∞", "–ü–æ–ª–∏–≤ —Ä–∞—Å–ø—ã–ª–µ–Ω–∏–µ–º"], c: 0 },
        { q: "–†–∞—Å—Ç–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∫—Ä–∞—Å–∏–≤–æ—Ü–≤–µ—Ç—É—â–∏–º –∫—É—Å—Ç–∞—Ä–Ω–∏–∫–∞–º:", a: ["–°–ø–∏—Ä–µ—è —è–ø–æ–Ω—Å–∫–∞—è", "–ü—É–∑—ã—Ä–µ–ø–ª–æ–¥–Ω–∏–∫", "–ö–∏–∑–∏–ª—å–Ω–∏–∫"], c: 0 },
        { q: "–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–∞–¥–∫–∏ –ª–∏—Å—Ç–æ–ø–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π:", a: ["–í –∏—é–Ω–µ", "–ü–µ—Ä–∏–æ–¥ –ø–æ–∫–æ—è", "–í —Å–µ—Ä–µ–¥–∏–Ω–µ –∏—é–ª—è"], c: 1 },
        { q: "–ß—Ç–æ —Ç–∞–∫–æ–µ ¬´—ç–∫—Å–ø–æ–∑–∏—Ü–∏—è¬ª –≤ —Ä–∞—Å—Ç–µ–Ω–∏–µ–≤–æ–¥—Å—Ç–≤–µ?", a: ["–°–æ—Å—Ç–∞–≤ –ø–æ—á–≤—ã", "–°—Ç–æ—Ä–æ–Ω—ã —Å–≤–µ—Ç–∞", "–°—Ä–æ–∫ —Ü–≤–µ—Ç–µ–Ω–∏—è"], c: 1 },
        { q: "–ö–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ pH –ø–æ—á–≤—ã —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–º?", a: ["4,5‚Äì5,0", "6,5‚Äì7,0", "8,0‚Äì9,0"], c: 1 },
        { q: "–ö–∞–∫–æ–µ —É–¥–æ–±—Ä–µ–Ω–∏–µ —Å—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç —Ä–æ—Å—Ç –ª–∏—Å—Ç—å–µ–≤?", a: ["–§–æ—Å—Ñ–æ—Ä–Ω–æ–µ", "–ê–∑–æ—Ç–Ω–æ–µ", "–ö–∞–ª–∏–π–Ω–æ–µ"], c: 1 },
        { q: "–î–ª—è —á–µ–≥–æ –ø—Ä–æ–≤–æ–¥—è—Ç ¬´–¥–µ–ª–µ–Ω–∏–µ –∫—É—Å—Ç–∞¬ª?", a: ["–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞", "–î–ª—è –æ–º–æ–ª–æ–∂–µ–Ω–∏—è", "–¢–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ–º—è–Ω"], c: 1 },
        { q: "–†–∞—Å—Ç–µ–Ω–∏—è-—ç—Ñ–µ–º–µ—Ä–æ–∏–¥—ã ‚Äî —ç—Ç–æ:", a: ["–¶–≤–µ—Ç—É—â–∏–µ –∫–æ—Ä–æ—Ç–∫–æ –≤–µ—Å–Ω–æ–π", "–¶–≤–µ—Ç—É—â–∏–µ –≤—Å—ë –ª–µ—Ç–æ", "–í–µ—á–Ω–æ–∑–µ–ª–µ–Ω—ã–µ"], c: 0 },
        { q: "–ñ–∏–≤–∞—è –∏–∑–≥–æ—Ä–æ–¥—å –≤ —Ç–µ–Ω–∏:", a: ["–ï–ª—å –æ–±—ã–∫–Ω–æ–≤–µ–Ω–Ω–∞—è", "–õ–∏–ø–∞", "–®–∏–ø–æ–≤–Ω–∏–∫"], c: 0 },
        { q: "–¶–≤–µ—Ç–Ω–∏–∫ —Å—Ç—Ä–æ–≥–æ–π –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–π —Ñ–æ—Ä–º—ã:", a: ["–ú–∏–∫—Å–±–æ—Ä–¥–µ—Ä", "–ö–ª—É–º–±–∞", "–†–æ–∫–∞—Ä–∏–π"], c: 1 },
        { q: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞ ‚Äî —ç—Ç–æ:", a: ["–í –≥—Ä—É–Ω—Ç–µ", "–í –≥–æ—Ä—à–∫–∞—Ö/–≤–∞–∑–æ–Ω–∞—Ö", "–í –≤–æ–¥–µ"], c: 1 },
        { q: "–ú—É–ª—å—á–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –¥–ª—è:", a: ["–ò—Å–ø–∞—Ä–µ–Ω–∏—è –≤–ª–∞–≥–∏", "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–ª–∞–≥–∏", "–ü–æ–≤—ã—à–µ–Ω–∏—è pH"], c: 1 },
        { q: "–í—Ä–µ–¥–∏—Ç–µ–ª—å, —Å–æ—Å—É—â–∏–π —Å–æ–∫ –ø–æ–±–µ–≥–æ–≤:", a: ["–ü—Ä–æ–≤–æ–ª–æ—á–Ω–∏–∫", "–¢–ª—è", "–ú–∞–π—Å–∫–∏–π –∂—É–∫"], c: 1 },
        { q: "–§—É–Ω–≥–∏—Ü–∏–¥—ã ‚Äî —ç—Ç–æ –±–æ—Ä—å–±–∞ —Å:", a: ["–°–æ—Ä–Ω—è–∫–∞–º–∏", "–ù–∞—Å–µ–∫–æ–º—ã–º–∏", "–ì—Ä–∏–±–∫–∞–º–∏"], c: 2 },
        { q: "–°–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞ ‚Äî —ç—Ç–æ:", a: ["–£–¥–∞–ª–µ–Ω–∏–µ –±–æ–ª—å–Ω—ã—Ö –≤–µ—Ç–æ–∫", "–®–∞—Ä–æ–≤–∏–¥–Ω–∞—è —Ñ–æ—Ä–º–∞", "–£–∫–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞ 1/3"], c: 0 },
        { q: "–ì–∞–∑–æ–Ω —Å —Ü–≤–µ—Ç–∞–º–∏ (–º–∞–∫–∏, –≤–∞—Å–∏–ª—å–∫–∏):", a: ["–ü–∞—Ä—Ç–µ—Ä–Ω—ã–π", "–ú–∞–≤—Ä–∏—Ç–∞–Ω—Å–∫–∏–π", "–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π"], c: 1 },
        { q: "–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ —Ä—É–ª–æ–Ω–Ω–æ–≥–æ –≥–∞–∑–æ–Ω–∞:", a: ["–î–µ—à–µ–≤–∏–∑–Ω–∞", "–ë—ã—Å—Ç—Ä—ã–π —ç—Ñ—Ñ–µ–∫—Ç", "–ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–∏–≤–∞"], c: 1 },
        { q: "–ü–æ—á–≤–æ–ø–æ–∫—Ä–æ–≤–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ:", a: ["–ë–∞—Ä–≤–∏–Ω–æ–∫ –º–∞–ª—ã–π", "–î–µ–ª—å—Ñ–∏–Ω–∏—É–º", "–ü–æ–¥—Å–æ–ª–Ω–µ—á–Ω–∏–∫"], c: 0 },
        { q: "¬´–í—ã–≥–æ–Ω–∫–∞¬ª ‚Äî —ç—Ç–æ:", a: ["–†–∞—Å—Å–∞–¥–∞", "–¶–≤–µ—Ç–µ–Ω–∏–µ –≤ –Ω–µ—Å–≤–æ–π—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è", "–£–¥–∞–ª–µ–Ω–∏–µ –±—É—Ç–æ–Ω–æ–≤"], c: 1 },
        { q: "–ü–æ—á–≤–∞ –¥–ª—è –∞–∑–∞–ª–∏–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:", a: ["–©–µ–ª–æ—á–Ω–∞—è", "–ö–∏—Å–ª–∞—è", "–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è"], c: 1 },
        { q: "–¶–≤–µ—Ç–Ω–∏–∫ –≤–¥–æ–ª—å –¥–æ—Ä–æ–∂–µ–∫ –∏–∑ –º–Ω–æ–≥–æ–ª–µ—Ç–Ω–∏–∫–æ–≤:", a: ["–†–∞–±–∞—Ç–∫–∞", "–ú–∏–∫—Å–±–æ—Ä–¥–µ—Ä", "–°–æ–ª–∏—Ç–µ—Ä"], c: 1 },
        { q: "–û–∫—É–ª–∏—Ä–æ–≤–∫–∞ ‚Äî —ç—Ç–æ –ø—Ä–∏–≤–∏–≤–∫–∞:", a: ["–ß–µ—Ä–µ–Ω–∫–æ–º", "–ü–æ—á–∫–æ–π (–≥–ª–∞–∑–∫–æ–º)", "–ö–æ—Ä–Ω–µ–º"], c: 1 },
        { q: "–≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –∑–∏–º–µ:", a: ["–ê–∑–æ—Ç", "–ö–∞–ª–∏–π", "–ú–∞–≥–Ω–∏–π"], c: 1 },
        { q: "–í —Ä–æ–∫–∞—Ä–∏–∏ –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å:", a: ["–í–ª–∞–∂–Ω–æ—Å—Ç—å", "–î—Ä–µ–Ω–∞–∂", "–¢–µ–Ω—å"], c: 1 }
    ];
    const jokes = [
        { min: 25, t: ["–í–µ–ª–∏–∫–∏–π –ë–æ—Ç–∞–Ω–∏–∫! –í–∞—à–∏ –∑–Ω–∞–Ω–∏—è –∫—Ä–µ–ø—á–µ, —á–µ–º –∫–æ—Ä–Ω–∏ –°–∞–Ω—Å–µ–≤–∏–µ—Ä–∏–∏. –î–∞–∂–µ –∫–∞–∫—Ç—É—Å—ã –≤ –≤–∞—à–µ–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω–∞—á–∏–Ω–∞—é—Ç —Ü–≤–µ—Å—Ç–∏ –æ—Ç –≤–æ—Å—Ç–æ—Ä–≥–∞! üåµ‚ú®"] },
        { min: 18, t: ["–£–≤–µ—Ä–µ–Ω–Ω—ã–π –°–∞–¥–æ–≤–Ω–∏–∫. –í—ã –Ω–µ –ø—É—Ç–∞–µ—Ç–µ –ø–µ—Ç—É–Ω–∏—é —Å —Å–æ—Ä–Ω—è–∫–æ–º ‚Äî –∏ —ç—Ç–æ —É–∂–µ —É—Å–ø–µ—Ö! –ü–æ–ª–µ–π—Ç–µ —Å–µ–±—è –∫–æ—Ñ–µ, –≤—ã —ç—Ç–æ –∑–∞—Å–ª—É–∂–∏–ª–∏. ‚òïüå±"] },
        { min: 10, t: ["–ù–∞—á–∏–Ω–∞—é—â–∏–π –†–æ—Å—Ç–æ–∫. –ü–æ–∫–∞ —á—Ç–æ –≤—ã –±–æ–ª—å—à–µ –ø–æ—Ö–æ–∂–∏ –Ω–∞ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∏–∫—É—Å ‚Äî –∫—Ä–∞—Å–∏–≤–æ, –Ω–æ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ —Å–æ–ª–Ω—Ü–∞ (–∏ —É—á–µ–±–Ω–∏–∫–æ–≤)! –ù–µ –∑–∞–≤—è–¥–∞–π—Ç–µ! üìö‚òÄÔ∏è"] },
        { min: 0, t: ["–ü–æ—á—ë—Ç–Ω—ã–π –û–¥—É–≤–∞–Ω—á–∏–∫. –í–∞—à–∏–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏ –º–æ–∂–Ω–æ –º—É–ª—å—á–∏—Ä–æ–≤–∞—Ç—å –≥—Ä—è–¥–∫–∏. –ù–æ –Ω–µ –≥—Ä—É—Å—Ç–∏—Ç–µ: –¥–∞–∂–µ –∏–∑ —Å–∞–º–æ–≥–æ –ª–µ–Ω–∏–≤–æ–≥–æ —Å–µ–º–µ—á–∫–∞ –º–æ–∂–µ—Ç –≤—ã—Ä–∞—Å—Ç–∏ –±–∞–æ–±–∞–±! (–ù–∞–≤–µ—Ä–Ω–æ–µ). ü§°üçÉ"] }
    ];

    let state = {
        current: parseInt(localStorage.getItem('quiz_current')) || 0,
        score: parseInt(localStorage.getItem('quiz_score')) || 0,
        fio: localStorage.getItem('quiz_fio') || "",
        finished: localStorage.getItem('quiz_finished') === 'true',
	startTime: Date.now()
    };

    function smoothSplash(x, y) {
        for(let i=0; i<12; i++){
            const p = document.createElement('div');
            p.className = 'smooth-leaf';
            p.style.left = x + 'px'; p.style.top = y + 'px';
            p.style.background = ['#2d6a4f','#40916c','#d4af37','#fdfdfd'][Math.floor(Math.random()*4)];
            document.getElementById('fx-container').appendChild(p);
            const angle = (Math.PI * 2 / 12) * i;
            const dist = 100 + Math.random() * 80;
            setTimeout(() => { p.style.transform = `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px) rotate(360deg) scale(0)`; p.style.opacity = '0'; }, 50);
            setTimeout(() => p.remove(), 1800);
        }
    }

    function spawnBgLeaf() {
        const leaf = document.createElement('div');
        leaf.className = 'leaf-bg';
        leaf.style.left = Math.random() * 100 + '%'; leaf.style.top = '-50px';
        leaf.style.setProperty('--tx',`${(Math.random()-0.5)*1000}px`);
        leaf.style.setProperty('--ty',`${window.innerHeight + 100}px`);
        leaf.style.animation = `flyBackground ${Math.random()*5+8}s linear forwards`;
        document.getElementById('fx-container').appendChild(leaf);
        setTimeout(() => leaf.remove(), 13000);
    }
    setInterval(spawnBgLeaf, 1000);

    window.onload = () => {
        if(state.finished) showFinal();
        else if(state.fio) { document.getElementById('login-ui').style.display='none'; document.getElementById('quiz-ui').style.display='flex'; render(); }
    };

    function save() {
        localStorage.setItem('quiz_current', state.current);
        localStorage.setItem('quiz_score', state.score);
        localStorage.setItem('quiz_fio', state.fio);
        localStorage.setItem('quiz_finished', state.finished);
    }

    function resetTest() { localStorage.clear(); location.reload(); }

    function startTest(e) {
        state.fio = document.getElementById('user-name').value.trim();
        if(state.fio.length < 2) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!");
	state.startTime = Date.now();
        smoothSplash(e.clientX || window.innerWidth/2, e.clientY || window.innerHeight/2);
        save(); document.getElementById('login-ui').style.display='none'; document.getElementById('quiz-ui').style.display='flex'; render();
    }

    function render() {
        document.getElementById('next-btn').disabled = true;
        if(state.current >= questions.length) return finish();
        const q = questions[state.current];
        document.getElementById('q-text').innerText = (state.current + 1) + ". " + q.q;
        const imgCont = document.getElementById('q-img-cont');
        if(q.imgUrl) { document.getElementById('q-image').src = q.imgUrl; imgCont.style.display = 'block'; } else { imgCont.style.display = 'none'; }
        const box = document.getElementById('options-box'); box.innerHTML = '';
        q.a.forEach((text, i) => {
            const item = document.createElement('div');
            item.className = 'option-item'; item.innerText = text;
            item.onclick = () => { document.querySelectorAll('.option-item').forEach(el=>el.classList.remove('selected')); item.classList.add('selected'); state.selected = i; document.getElementById('next-btn').disabled = false; };
            box.appendChild(item);
        });
    }

    function nextQuestion(e) {
        smoothSplash(e.clientX || window.innerWidth/2, e.clientY || window.innerHeight/2);
        if(state.selected === questions[state.current].c) state.score++;
        state.current++; save(); render();
    }

    function finish() { state.finished = true; save(); showFinal(); const timeSpent = Math.floor((Date.now() - state.startTime) / 1000); fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({fio: state.fio, score: state.score, total: questions.length, timeSpent: timeSpent}) }); }

    function showFinal() {
        document.getElementById('login-ui').style.display='none'; document.getElementById('quiz-ui').style.display='none'; document.getElementById('result-ui').style.display='flex';
        document.getElementById('final-score').innerText = state.score + " / " + questions.length;
        const cat = jokes.find(j => state.score >= j.min) || jokes[jokes.length-1];
        document.getElementById('final-joke').innerText = cat.t[Math.floor(Math.random() * cat.t.length)];
    }
</script>
</body>
</html>
